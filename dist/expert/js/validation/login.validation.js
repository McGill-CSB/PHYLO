/*
*
* PHYLO Distribution Build v3.1.0
* http://phylo.cs.mcgill.ca
*
* Copyright 2013 McGill university, Alfred Kam, Jerome Waldispuhl and other contributors
* Under McGill Human-Computing Developer Licence
* https://github.com/McGill-CSB/PHYLO/blob/master/McGill-LICENCE.txt
*
*/!function(){$(document).ready(function(){if($(".showlogout").hide(),$(".dropdown-menu").find("form").click(function(a){a.stopPropagation()}),$.cookie.read("username")){$(".login-btn").unbind("click");var a=$.cookie.read("username"),b=$.cookie.read("fullname"),c=$.cookie.read("loginmode"),d=$.cookie.read("logid");"Classic"==c?($("#login-tag").html(a),$(".showlogin").hide(),$(".showlogout").show(),window.guest=a,$(".showInLogin").show()):$.get("http://phylo.cs.mcgill.ca/phpdb/social/isconnected.php?provider="+c+"&logid="+d,function(e){return"succ"!=e?(console.log(c+" connection failed. Please, check that you are already connected to "+c+"."),window.guest="Guest",$.cookie.delete("username"),$.cookie.delete("fullname"),$.cookie.delete("loginmode"),$.cookie.delete("logid"),$(".showlogout").hide(),$(".showlogin").show(),$(".login-btn").click(function(){eClick()}),void(window.location="http://phylo.cs.mcgill.ca/expert/welcome.php")):($.ajax({type:"POST",url:"http://phylo.cs.mcgill.ca/phpdb/passwdmanager.php",data:"username="+a+"&id="+d}).done(function(b){var d=b;$.protocal.login(a,d,function(a){return"succ"!=a?(console.log("Cannot not login expert version using "+c+"account."),window.guest="Guest",$.cookie.delete("username"),$.cookie.delete("fullname"),$.cookie.delete("loginmode"),$.cookie.delete("logid"),$(".showlogout").hide(),$(".showlogin").show(),$(".login-btn").click(function(){eClick()}),void(window.location="http://phylo.cs.mcgill.ca/expert/welcome.php")):void 0})}).fail(function(){console.log("Could not connect to the server. Please try again later."),window.guest="Guest",$.cookie.delete("username"),$.cookie.delete("fullname"),$.cookie.delete("loginmode"),$.cookie.delete("logid"),$(".showlogout").hide(),$(".showlogin").show(),$(".login-btn").click(function(){eClick()}),window.location="http://phylo.cs.mcgill.ca/expert/welcome.php"}),$("#login-tag").html(b.replace("+"," ")),$(".showlogin").hide(),$(".showlogout").show(),window.guest=a,$(".showInLogin").show(),void 0)}),$.ajax({type:"POST",url:"/phpdb/phyloExpertDB.php",data:"mode=8&user="+a}).done(function(a){"succ"!=a&&(window.guest="Guest",$.cookie.delete("username"),$.cookie.delete("fullname"),$.cookie.delete("loginmode"),$.cookie.delete("logid"),$(".showlogout").hide(),$(".showlogin").show(),$(".login-btn").click(function(){eClick()}),bootbox.alert("You must complete 20 puzzles of the classic edition before accessing the Expert version.",function(){window.location="http://phylo.cs.mcgill.ca/expert/welcome.php"}))}).fail(function(){$(".showInLogin").show(),console.log("Expert validation failed. Could not connect to the server."),$.cookie.delete("username"),$.cookie.delete("fullname"),$.cookie.delete("loginmode"),$.cookie.delete("logid"),$(".showlogout").hide(),$(".showlogin").show(),$(".login-btn").click(function(){eClick()}),window.location="http://phylo.cs.mcgill.ca/expert/welcome.php"})}var e=function(){var a=$("#username").val().trim(),b=$("#password").val().trim();return""==a||""==b?void bootbox.alert("Username or Password is missing"):void $.protocal.login(a,b,function(b){"succ"==b?(bootbox.alert("Welcome back "+a),$("#login-tag").html(a),$(".showlogin").hide(),$(".showlogout").show(),window.guest=a,$(".showInLogin").show(),$.cookie.create("username",a,365),$.cookie.create("fullname",a,365),$.cookie.create("loginmode","Classic",365),$.cookie.create("logid",-1,365)):bootbox.alert("Incorrect Username or Password.")})},f=function(a){console.log("Try social login with "+a);var b="http://phylo.cs.mcgill.ca/phpdb/social/login.php?provider="+a+"&returnto="+document.URL;window.location.href=b};$(".login-btn").click(function(){e()}),$(".zocial.facebook").click(function(){f("Facebook")}),$(".zocial.twitter").click(function(){f("Twitter")}),$(".zocial.google").click(function(){f("Google")}),$(".zocial.linkedin").click(function(){f("LinkedIn")}),$(".logout").click(function(a){a.preventDefault(),bootbox.confirm("Do you want to logout?","No","Logout",function(a){a&&(window.guest="Guest",$.cookie.delete("username"),$.cookie.delete("fullname"),$.cookie.delete("loginmode"),$.cookie.delete("logid"),$(".showlogout").hide(),$(".showlogin").show(),$(".login-btn").click(function(){eClick()}),window.location="http://phylo.cs.mcgill.ca/expert/welcome.php")})}),$(".cancel-btn").click(function(){$(".email-holder").hide(),$(".register-btn").addClass("register-btn-shift"),$(".login-btn").show(),$(this).hide()})})}();