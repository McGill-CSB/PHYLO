function reset(a,b){if(!resetting){resetting=!0,clearInterval(drawThread),clearInterval(calcThread),pos=new Array,multisel=null,originaltree=b,ancestorpos=new Array,globalredraw={fitch:!1},currenttree=null,bestscore=-1e4;for(var c=0;c<a.length;c++)pos[c]=new Array,createRow(c,c*G_H,a[c]),finalize(c);vp=new Array,fitchCalculator=new FitchCalculator,originaltree=b,$(document).unbind(),canvas=$("#drawing-area").unbind().get(0),canvas.width=V_W,canvas.height=V_H,ctx=canvas.getContext("2d"),tcanvas=$("#tree-area").unbind().get(0),tcanvas.width=T_W,tcanvas.height=T_H,tctx=tcanvas.getContext("2d"),viewport=$("#viewport").unbind().get(0),viewport.width=VP_W,viewport.height=VP_H,vctx=viewport.getContext("2d");var d=$("#scorebar-area").unbind().get(0);d.width=SB_W,d.height=SB_H,sb=new ScoreBar(d),sb.setScores({score:0,best:0,par:0});var e=$("#buttoncolumn-area").unbind().get(0);e.width=BC_W,e.height=BC_H,bc=new ButtonColumn(e),bc.draw(),$("#stats-par").text().length>0&&sb.setPar($("#stats-par").text()),setDrag(),setViewportDrag(),recalc(),resetOverrideTree(),vp.redraw=!0,pos.redraw=!0,drawThread=setInterval(draw,33),fitchrecalcneeded=!0,recalcFitch(),calcThread=setInterval(recalcFitch,400),resetting=!1}}function init(a,b){loadImages(function(){reset(a,b),sb.setPar($("#scores-score").text()),$("#stats-par").text($("#scores-score").text())})}function loadImages(a){function b(){d.count<e?(console.log("still waiting"),setTimeout(b,20)):(console.log("images loaded"),a())}for(var c=function(a,b,c){var d=new Image;d.onload=function(){c.count+=1,b.push(this)},d.onerror=function(){c.count+=1},d.src=a},d={count:0},e=0,f=0;f<T_IMAGES_NAMES.length;f++)c(T_IMAGES_DIR+T_IMAGES_NAMES[f],T_IMAGES,d),e++;setTimeout(b,0)}function findMaxLength(){for(var a=0,b=0;b<pos.length;b++)pos[b][pos[b].length-1].left>a&&(a=pos[b][pos[b].length-1].left);var c=Math.ceil(a/G_W+1);return console.log("max "+c+"("+a+","+G_W+")"),c}function GameState(a,b,c){var d=function e(a){return void 0==a?a:{0:e(a[0]),1:e(a[1]),ancestor:a.value}};this.user=window.guest,this.stage=a,this.tree=b,this.score=sb.currentScore,this.overridetree=d(c)}function getCurrentState(){var a=extractCurrentTree(),b=new GameState(args.id,a,window.overridetree);return b}function loadState(a){args.id=a.stage;var b=parseInput(a.tree);reset(b,a.tree)}function extractCurrentTree(){for(var a=new Array(pos.length),b=findMaxLength(),c=["A","T","C","G"],d=0;d<pos.length;d++){var e,f=new Array(b);for(e=0;b>e;e++)f[e]=".";for(e=0;e<pos[d].length;e++)f[~~((pos[d][e].left+G_W/2)/G_W)]=c[pos[d][e].kind];a[d]=f.join("")}var g=FitchCalculator.buildTree(originaltree,a);return g}function recalcFitch(){if(fitchrecalcneeded){fitchrecalcneeded=!1;var a=extractCurrentTree(),b=fitch.getFinalTree(a,overridetree);if(currentancestor?(currentancestorn=FitchCalculator.treeops.getNodeIndex(currenttree,currentancestor),0>currentancestorn&&(currentancestorn=0)):currentancestorn=0,currentancestor=FitchCalculator.treeops.findNthNode(b.tree,currentancestorn),currentancestor?createAncestorRow(currentancestor.stringancestor):createAncestorRow(b.ancestor),$("#stats-matches").text(b.info.match),$("#stats-gapexts").text(b.info.gap_ext),$("#stats-mismatches").text(b.info.mismatch),$("#stats-gaps").text(b.info.gap_open),$("#scores-score").text(b.score),sb.setScore(b.score),b.score>bestscore){$("#scores-best").text(b.score),bestscore=b.score;var c=localStorage.getItem(args.id+"-Best");if(c&&JSON.parse(c).score<bestscore||!c){var d=getCurrentState();console.log(d),localStorage.setItem(args.id+"-Best",JSON.stringify(d)),bc.setScoreForState("Best",d.score)}}currenttree=b.tree,pos.redraw=!0,globalredraw.fitch=!0}}function createAncestorRow(a){var b,c,d=new Array,e=new Array;for(b=0,c=0;b<a.length;b++,c++)switch(a.charAt(b)){case"A":d[c]={id:0,colCount:b};break;case"U":case"T":d[c]={id:1,colCount:b};break;case"C":d[c]={id:2,colCount:b};break;case"G":d[c]={id:3,colCount:b};break;default:c--}for(b=0;b<d.length;b++)d[b].id>3||(e[b]=new Array,e[b].row=V_ANCESTOR_ROW,e[b].left=d[b].colCount*G_W,e[b].top=V_ANCESTOR_ROW*G_H,e[b].redraw=!0,e[b].kind=d[b].id);ancestorpos=e}function parseFoldOutput(a){for(var b=new Array,c=new Array,d=0,e=0;d<a.length;d++)switch(a.charAt(d)){case"<":c.push(d);break;case">":b[e++]={0:c.pop(),1:d}}return b.sort(function(a,b){return a[0]-b[0]}),b}function setDrag(){var a,b=null,c=0,d=!1,e="";$(document).mousedown(function(a){if(console.log(e),"select"!=e){var f=$(canvas).offset(),g=a.pageX-f.left-S_MINX,h=a.pageY-f.top-S_MINY,i=~~(h/G_H);if(b=null,d=!0,i!=V_ANCESTOR_ROW){if(i>=0&&i<pos.length)for(var j=0;j<pos[i].length;j++)if(pos[i][j].left+G_W>g&&pos[i][j].left<g){if(b=pos[i][j],b.drag=!0,c=g-pos[i][j].left,multisel)for(multisel.x=g,multisel.y=h,j=0;j<pos.length;j++)for(var k=0;k<pos[j].length;k++)pos[j][k].selected&&(pos[j][k].drag=!0,pos[j][k].oldleft=pos[j][k].left);break}null==b&&(c=g),e="main"}else $("#ancestor-selection-box").css({top:V_ANCESTOR_ROW*G_H+f.top-B_W,left:~~(g/G_W)*G_W+f.left+S_MINX-B_W}).show(),e="ancestor-change"}}),$(document).mouseup(function(c){switch(d=!1,e){case"main":if(null!=b){if(b.drag=!1,multisel)for(var f=0;f<pos.length;f++)finalize(f);else finalize(b.row);resetOverrideTree(),b=null}else{for(var f=0;f<pos.length;f++)for(var g=0;g<pos[f].length;g++)pos[f][g].selected=!1,pos[f][g].drag=!1;multisel=null,e="",pos.redraw=!0}break;case"viewport":S_MINX=~~S_MINX,vp.redraw=!0,pos.redraw=!0;break;case"select":$("#selection-box").hide(),multisel.state="selected",e="";break;case"ancestor-change":var h=ancestorGetDistances(c.pageX,c.pageY),i=$(canvas).offset(),j=$("#ancestor-selection-box").offset();$("#ancestor-selection-box").hide();var k,l={top:1,left:0,bottom:3,right:2};k=h[h.dir]>.7?l[h.dir]:4,setOverride(currentancestor,~~((j.left-i.left-S_MINX+G_W)/G_W),k),fitchrecalcneeded=!0,a=null,e=""}}),$(document).mousemove(function(a){if(0===a.which&&(d=!1),d)switch(e){case"main":if(null!=b){var f=a.pageX-$(canvas).offset().left;if(multisel){for(var g=multisel.x+S_MINX-f,h=0;h<pos.length;h++)for(var i=0;i<pos[h].length;i++)pos[h][i].selected&&(pos[h][i].left=pos[h][i].oldleft-g);pos.redraw=!0}else b.left=f-S_MINX-c;fitchrecalcneeded=!0,recalc()}else{var f=a.pageX-$(canvas).offset().left;S_MINX=-(c-f),S_MINX=Math.min(Math.max(-S_W+V_W,S_MINX),0),VP_VP_LEFT=-(S_MINX/G_W*VP_B_W),pos.redraw=!0}break;case"ancestor-change":var j=$(canvas).offset(),f=a.pageX-j.left-S_MINX;a.pageY-j.top-S_MINY,ancestorSetBorderColours(ancestorGetDistances(a.pageX,a.pageY));break;case"viewport":var f=a.pageX-$(viewport).offset().left;VP_VP_LEFT=Math.min(Math.max(0,f-VP_VP_W/2),VP_W-VP_VP_W),S_MINX=-(VP_VP_LEFT/VP_B_W*G_W),vp.redraw=!0,pos.redraw=!0}else switch(e){case"select":if("start"==multisel.state){multisel.p2.x=a.pageX,multisel.p2.y=a.pageY;var k=multisel.p1.y>multisel.p2.y?multisel.p2.y:multisel.p1.y,l=multisel.p1.x>multisel.p2.x?multisel.p2.x:multisel.p1.x,m=Math.abs(multisel.p1.x-multisel.p2.x),n=Math.abs(multisel.p1.y-multisel.p2.y),j=$(canvas).offset(),o=~~((k-j.top-S_MINY)/G_H),p=~~((k+n-j.top-S_MINY)/G_H);b.offset({top:k,left:l}).width(m).height(n);for(var h=0;h<pos.length;h++)for(var i=0;i<pos[h].length;i++)pos[h][i].selected=!1;for(var h=o>=0?o:0;h<pos.length&&p>=h;h++){var i;for(i=0;i<pos[h].length&&!(pos[h][i].left+j.left+S_MINX+G_W>l);i++);for(;i<pos[h].length&&pos[h][i].left+j.left+S_MINX<m+l;i++)pos[h][i].selected=!0}pos.redraw=!0}}}),$(document).dblclick(function(a){if(multisel){for(var c=0;c<pos.length;c++)for(var d=0;d<pos[c].length;d++)pos[c][d].selected=!1,pos[c][d].drag=!1;multisel=null,e="",pos.redraw=!0}else b=$("#selection-box").show().offset({top:a.pageY,left:a.pageX}).width(0).height(0),e="select",multisel={state:"start",p1:{x:a.pageX,y:a.pageY},p2:{x:a.pageX,y:a.pageY}}}),$(viewport).mousedown(function(a){if("select"!=e){var b=a.pageX-$(viewport).offset().left;return d=!0,c=b,e="viewport",!1}}),$(tcanvas).mousemove(function(b){var c=function f(a,b,c){if(a instanceof Object&&void 0!=a[0]){if(a.ancestorlocation&&a.ancestorlocation.left<b&&a.ancestorlocation.left+a.ancestorlocation.width>b&&a.ancestorlocation.top<c&&a.ancestorlocation.top+a.ancestorlocation.height>c)return a;var d=f(a[0],b,c);return null!=d?d:d=f(a[1],b,c)}return null},d=$(tcanvas).offset(),e=c(currenttree,b.pageX-d.left,b.pageY-d.top);null!=e?e!=currentancestor&&(a=currentancestor,currentancestor=e,drawTree(tctx),createAncestorRow(currentancestor.stringancestor),pos.redraw=!0):(currentancestor!=a&&null!=a&&(currentancestor=a,drawTree(tctx),createAncestorRow(currentancestor.stringancestor),pos.redraw=!0),a=null)}),$(tcanvas).mousedown(function(){a=currentancestor})}function setOverride(a,b,c){var d=function f(a,b,c){if(a instanceof Object&&void 0!=a[0]){if(c==a)return b;var d=f(a[0],b[0],c);return null!=d?d:d=f(a[1],b[1],c)}return null};console.log(b,c);var e=d(currenttree,overridetree,a);null!=e&&(e.value[b]=c)}function resetOverrideTree(){var a=FitchCalculator.seqLength(originaltree)+20,b=function d(a,b){a instanceof Object&&void 0!=a[0]?(d(a[0],b),d(a[1],b),a.value=new Array(b)):a instanceof Object&&(a.value=new Array(b))},c=new Array(pos.length);overridetree=FitchCalculator.buildTree(originaltree,c),b(overridetree,a),overridetree.set=!1}function ancestorGetDistances(a,b){var c=$("#ancestor-selection-box").offset(),d=c.left+1.5*B_W,e=c.top+1.5*B_H,f=.2,g=1,h={top:-.2,left:-.2,bottom:-.2,right:-.2},i=a-d,j=b-e,k=-Math.atan2(j,i),l=Math.min(Math.max(Math.sqrt(i*i+j*j)/(2*B_W),f),g);return Math.abs(k)<Math.PI/4?(h.right=1,h.dir="right"):Math.abs(k)>.75*Math.PI?(h.left=1,h.dir="left"):k>0?(h.top=1,h.dir="top"):(h.bottom=1,h.dir="bottom"),h.top=h.top*l+.4,h.left=h.left*l+.4,h.right=h.right*l+.4,h.bottom=h.bottom*l+.4,h}function ancestorSetBorderColours(a){$("#ancestor-selection-box").css({"border-top-color":B_COLOUR_A[0]+a.top+")","border-left-color":B_COLOUR_A[1]+a.left+")","border-bottom-color":B_COLOUR_A[2]+a.bottom+")","border-right-color":B_COLOUR_A[3]+a.right+")"})}function setViewportDrag(){}function createRow(a,b,c){if(void 0!=args.rand)var d=generateRandomRowPositions(c.length,S_W-G_W);for(var e=0;e<c.length;e++)c[e].id>3||(pos[a][e]=new Array,pos[a][e].row=a,pos[a][e].left=args.rand?S_MINX+d[e]:c[e].colCount*G_W,pos[a][e].top=b,pos[a][e].redraw=!0,pos[a][e].kind=c[e].id)}function generateRandomRowPositions(a,b){for(var c=new Array,d=0;a>d;d++)c[d]=Math.floor(Math.random()*b);return c=c.sort(function(a,b){return a-b})}function finalize(a){for(var b=0;b<pos[a].length;b++)pos[a][b].left=~~((pos[a][b].left+G_W/2)/G_W)*G_W,pos[a][b].redraw=!0}function recalc(){var a,b,c=!1,d=0;for(a=0;a<pos.length;a++){for(c=!1,d=S_W,b=pos[a].length-1;b>=0;b--)pos[a][b].drag?(c=!0,pos[a][b].redraw=!0):c&&pos[a][b].left>d-G_W&&(pos[a][b].left=d-G_W,pos[a][b].redraw=!0),d=pos[a][b].left;for(c=!1,d=-G_W,b=0;b<pos[a].length;b++)pos[a][b].drag?(c=!0,pos[a][b].redraw=!0):c&&pos[a][b].left<d+G_W&&(pos[a][b].left=d+G_W,pos[a][b].redraw=!0),d=pos[a][b].left;for(c=!1,d=-G_W,b=0;b<pos[a].length;b++)pos[a][b].left<d+G_W&&(pos[a][b].left=d+G_W,pos[a][b].redraw=!0),d=pos[a][b].left;for(c=!1,d=S_W,b=pos[a].length-1;b>=0;b--)pos[a][b].left>d-G_W&&(pos[a][b].left=d-G_W,pos[a][b].redraw=!0),d=pos[a][b].left}}function drawRow(a,b,c){for(var d=0;d<pos[b].length;d++)pos[b][d].left+S_MINX+B_XOFFSET>=-G_W&&pos[b][d].left+S_MINX+B_XOFFSET+G_W<=V_W+G_W&&(c?(a.fillStyle=B_COLOUR_H[pos[b][d].kind],a.fillRect(pos[b][d].left+S_MINX+B_XOFFSET,pos[b][d].top+S_MINY+B_YOFFSET,B_W,B_H),a.strokeStyle=BS_COLOUR_H[pos[b][d].kind],a.strokeRect(pos[b][d].left+S_MINX+B_XOFFSET,pos[b][d].top+S_MINY+B_YOFFSET,B_W,B_H)):(a.fillStyle=pos[b][d].selected?B_COLOUR_S[pos[b][d].kind]:B_COLOUR[pos[b][d].kind],a.fillRect(pos[b][d].left+S_MINX+B_XOFFSET,pos[b][d].top+S_MINY+B_YOFFSET,B_W,B_H))),pos[b][d].redraw=!1}function drawAncestorRow(a){for(var b=0;b<ancestorpos.length;b++)ancestorpos[b].left+S_MINX+B_XOFFSET>=-G_W&&ancestorpos[b].left+S_MINX+B_XOFFSET+G_W<=V_W+G_W&&(a.fillStyle=B_COLOUR[ancestorpos[b].kind],a.fillRect(ancestorpos[b].left+S_MINX+B_XOFFSET,ancestorpos[b].top+S_MINY+B_YOFFSET,B_W,B_H)),ancestorpos[b].redraw=!1}function draw(){if(resizeinfo.resize&&(canvas.width=resizeinfo.canvas_width,viewport.width=resizeinfo.viewport_width,resizeinfo.resize=!1,pos.redraw=!0),pos.redraw){ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.restore(),generateGrid(ctx);for(var a=0;a<pos.length;a++)drawRow(ctx,a);drawAncestorRow(ctx),pos.redraw=!1,drawViewport(!0)}else{var b=!1;ctx.save();for(var a=0;a<pos.length;a++){var c;for(c=0;c<pos[a].length&&!pos[a][c].redraw;c++);c<pos[a].length&&(ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,G_H*a+S_MINY,V_W,G_H),b=!0,pos[a].redraw=!0)}if(ctx.restore(),b){generateGrid(ctx);for(var a=0;a<pos.length;a++)if(pos[a].redraw){for(var c=0;c<pos[a].length;c++)pos[a][c].left+S_MINX+B_XOFFSET>=-G_W&&pos[a][c].left+S_MINX+B_XOFFSET+G_W<=V_W+G_W&&(ctx.fillStyle=pos[a][c].selected?B_COLOUR_S[pos[a][c].kind]:B_COLOUR[pos[a][c].kind],ctx.fillRect(pos[a][c].left+S_MINX+B_XOFFSET,pos[a][c].top+S_MINY+B_YOFFSET,B_W,B_H)),pos[a][c].redraw=!1;pos[a].redraw=!1}drawAncestorRow(ctx),drawViewport(!0)}else drawViewport(!1)}globalredraw.fitch&&(drawTree(tctx),globalredraw.fitch=!1)}function drawViewport(a){if(a||vp.redraw){vctx.save(),vctx.setTransform(1,0,0,1,0,0),vctx.clearRect(0,0,viewport.width,viewport.height),vctx.restore();for(var b=0,c=0;c<pos.length;c++)for(var d=0;d<pos[c].length;d++)vctx.fillStyle=B_COLOUR[pos[c][d].kind],b=~~(pos[c][d].left/G_W),vctx.fillRect(b*VP_B_W,c*VP_B_H,VP_B_W,VP_B_H);vctx.fillStyle=VP_OVERLAY_COLOUR,vctx.fillRect(0,0,VP_VP_LEFT,VP_VP_H),vctx.fillRect(VP_VP_LEFT+VP_VP_W,0,VP_W-VP_VP_LEFT-VP_VP_W,VP_VP_H),vctx.strokeStyle=VP_BORDER_COLOUR,vctx.lineWidth=VP_BORDER_WIDTH,vctx.strokeRect(VP_VP_LEFT,0,VP_VP_W,VP_VP_H),vp.redraw=!1}}function generateGrid(a){a.beginPath();for(var b=0;G_ROW>=b;b++)a.moveTo(-.5,S_MINY+b*G_H+.5),a.lineTo(V_W+.5,S_MINY+b*G_H+.5);for(var c=~~(V_W/G_W)+1,d=0;c>=d;d++)a.moveTo(S_MINX%G_W+d*G_W+.5,S_MINY+.5),a.lineTo(S_MINX%G_W+d*G_W+.5,S_MINY+G_ROW*G_H-1+.5);a.lineWidth=1,a.strokeStyle=G_COLOUR,a.stroke(),a.closePath()}function drawTree(a){var b=function j(a,b,c){if(a instanceof Object&&void 0!=a[0]){var d=0;b[0]={},b[1]={};var e=j(a[0],b[0],c),f=j(a[1],b[1],c);return d=Math.max(e.depth,d),d=Math.max(f.depth,d),b.depth=d+1,b.height=(e.height+f.height)/2,b.from=e.height,b.to=f.height,b.node=a,b}return b.depth=0,b.height=c[0],c[0]+=1,b},c=function k(b,c){return b instanceof Object&&void 0!=b[0]?(c=k(b[0],b.depth,c),c=k(b[1],b.depth)):a.drawImage(T_IMAGES[c],0,0,T_IMAGES[c].width,T_IMAGES[c].height,T_W-30,T_TOP+~~(b.height*T_SIZE_V)-T_IMAGES_DRAW_H/2,T_IMAGES_DRAW_W,T_IMAGES_DRAW_H),c+1},d=function l(b,c){b instanceof Object&&void 0!=b[0]?(l(b[0],b.depth),l(b[1],b.depth),a.moveTo(T_W-(b.depth*T_SIZE_H+T_RIGHT),T_TOP+~~(b.from*T_SIZE_V)),a.lineTo(T_W-(b.depth*T_SIZE_H+T_RIGHT),T_TOP+~~(b.to*T_SIZE_V)),a.moveTo(T_W-(b.depth*T_SIZE_H+T_RIGHT),T_TOP+~~(b.height*T_SIZE_V)),a.lineTo(T_W-(c*T_SIZE_H+T_RIGHT),T_TOP+~~(b.height*T_SIZE_V))):(a.moveTo(T_W-(b.depth*T_SIZE_H+T_RIGHT),T_TOP+~~(b.height*T_SIZE_V)),a.lineTo(T_W-(c*T_SIZE_H+T_RIGHT),T_TOP+~~(b.height*T_SIZE_V)))},e=function m(b,c){b instanceof Object&&void 0!=b[0]&&(m(b[0],c),m(b[1],c),(!c&&b.node!=currentancestor||c&&b.node==currentancestor)&&a.rect(T_W-(b.depth*T_SIZE_H+T_RIGHT)-T_ANCESTOR_BUTTON_W/2,T_TOP+~~(b.height*T_SIZE_V)-T_ANCESTOR_BUTTON_H/2,T_ANCESTOR_BUTTON_W,T_ANCESTOR_BUTTON_H),b.node.ancestorlocation={top:T_TOP+~~(b.height*T_SIZE_V)-T_ANCESTOR_BUTTON_W/2,left:T_W-(b.depth*T_SIZE_H+T_RIGHT)-T_ANCESTOR_BUTTON_W/2,width:T_ANCESTOR_BUTTON_W,height:T_ANCESTOR_BUTTON_H})},f=function n(b){if(b instanceof Object&&void 0!=b[0]){n(b[0]),n(b[1]);var c;c=b.node.score>0?"+"+b.node.score:""+b.node.score,a.fillText(c,T_W-(b.depth*T_SIZE_H+T_RIGHT)-3,T_TOP+~~(b.height*T_SIZE_V))}},g={};b(currenttree,g,[0]),a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,tcanvas.width,tcanvas.height),a.restore();var h=a.createLinearGradient(T_W,0,T_W-T_BACKGROUND_GRID_W,0);h.addColorStop(0,G_COLOUR),h.addColorStop(1,G_COLOUR_A),a.strokeStyle=h,a.lineWidth=1,a.beginPath();for(var i=0;G_ROW>=i;i++)a.moveTo(T_W-T_BACKGROUND_GRID_W+.5,i*G_H+.5),a.lineTo(T_W+.5,i*G_H+.5);a.closePath(),a.stroke(),c(g,0),a.font="12px sans-serif",a.textBaseline="middle",a.textAlign="right",a.fillStyle=T_COLOUR,a.fillText("Ancestor",T_W-5,G_H*V_ANCESTOR_ROW+G_H/2),a.fillStyle=T_COLOUR,a.strokeStyle=T_COLOUR,a.beginPath(),d(g,8),a.closePath(),a.lineWidth=T_THICKNESS,a.lineCap="square",a.stroke(),a.fill(),a.fillStyle=T_COLOUR,a.beginPath(),e(g,!1),a.closePath(),a.fill(),a.fillStyle=T_COLOUR_S,a.beginPath(),e(g,!0),a.closePath(),a.fill(),args.ui_showscore&&(a.font="10px sans-serif",a.textBaseline="bottom",a.textAlign="right",a.fillStyle=T_COLOUR,f(g))}var pos=new Array,ctx,canvas,tcanvas,tctx,viewport,vctx,vp,multisel,originaltree,ancestorpos=new Array,currenttree,overridetree,currentancestor,currentancestorn,globalredraw={fitch:!1},bestscore=-1e4,drawThread,calcThread,sb,bc,resetting=!1,resizeinfo={},msg,fitch,fitchrecalcneeded=!1;$(function(){initHTMLElements(),getSequences(init)});