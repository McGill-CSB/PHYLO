function FitchCalculator(){this.GAP_EXT=-1,this.GAP_OPEN=-4,this.CHARS={T:1,A:2,G:4,C:8,".":16},this.CHARS_INDEX={T:0,A:1,G:2,C:3,".":4},this.RCHARS=["T","A","G","C","."],this.SCORE_MATRIX={A:{A:1,C:-1,G:-1,T:-1,".":-1},C:{A:-1,C:1,G:-1,T:-1,".":-1},G:{A:-1,C:-1,G:1,T:-1,".":-1},T:{A:-1,C:-1,G:-1,T:1,".":-1},".":{A:-1,C:-1,G:-1,T:-1,".":0}},this.GAP_MATRIX={A:{A:0,C:0,G:0,T:0,".":1},C:{A:0,C:0,G:0,T:0,".":1},G:{A:0,C:0,G:0,T:0,".":1},T:{A:0,C:0,G:0,T:0,".":1},".":{A:1,C:1,G:1,T:1,".":0}}}function DumpObjectIndented(a,b){var c="";null==b&&(b="");for(var d in a){var e=a[d];if("string"==typeof e)e="'"+e+"'";else if("object"==typeof e)if(e instanceof Array)e="[ "+e+" ]";else{var f=DumpObjectIndented(e,b+"  ");e="\n"+b+"{\n"+f+"\n"+b+"}"}c+=b+"'"+d+"' : "+e+",\n"}return c.replace(/,\n$/,"")}FitchCalculator.diffSeqs=function(){for(var a,b=0,c=0,d=0,e=0;e<fold.length;e++)a=this.diffMatrix[this.original.charAt(e)][fold.charAt(e)],b+=a[0],c+=a[1],d+=a[2];return{difference:b,extra:c,missing:d}},FitchCalculator.treeops={},FitchCalculator.treeops.findNode=function(a,b){var c=function d(a,b,c){if(a instanceof Object&&void 0!=a[0]){if(b.bind(c)(a))return a;var e=d(a[0],b,c);return null!=e?e:d(a[1],b,c)}return null};return c(a,b,this)},FitchCalculator.treeops.findNthNode=function(a,b){var c=function e(a,c){if(a instanceof Object&&void 0!=a[0]){if(c.count==b)return a;c.count+=1;var d=e(a[0],c);return null!=d?d:e(a[1],c)}return null},d={count:0};return c(a,d)},FitchCalculator.treeops.getNodeIndex=function(a,b){var c=function e(a,c){if(a instanceof Object&&void 0!=a[0]){if(a==b)return c.count;c.count+=1;var d=e(a[0],c);return null!=d?d:e(a[1],c)}return-1},d={count:0};return c(a,d)},FitchCalculator.buildTree=function a(b,c){return b instanceof Array?[a(b[0],c),a(b[1],c)]:c.shift()},FitchCalculator.seqLength=function(a){return a instanceof Array?FitchCalculator.seqLength(a[0]):a.length},FitchCalculator.prototype.getFinalTree=function(a,b){var c=function(a){return a-=1431655765&a>>1,a=(858993459&a>>2)+(858993459&a),a=252645135&(a>>4)+a,a+=a>>8,a+=a>>16,63&a},d=function(a){return c((a&-a)-1)},e=function r(a,b,c,e,f){var g=[1,2,4,8,16];return a instanceof Array?(void 0==c.seq&&(c.seq=new Array,c.ancestor=new Array,c[0]={},c[1]={}),void 0==e.value||void 0==e.value[b]?c.ancestor[b]=0==(a[2]&g[f])?Math.min(d(a[2]),4):f:(overridecode=1<<e.value[b],c.ancestor[b]=Math.min(d(overridecode),4)),r(a[0],b,c[0],e[0],c.ancestor[b]),r(a[1],b,c[1],e[1],c.ancestor[b]),a[2]):(void 0==c.seq&&(c.seq=new Array,c.ancestor=new Array),c.seq[b]=a,c.ancestor[b]=Math.min(d(a),4),a)},f=function s(a,b){if(a instanceof Array||a instanceof Object&&void 0!=a[0]){s(a[0],b),s(a[1],b),a.stringancestor="";for(var c=0;c<a.ancestor.length;c++)a.stringancestor+=b[a.ancestor[c]]}};console.log(c(15)),console.log(d(241));for(var g=new Array,h=new Array,i=new Array,j=FitchCalculator.seqLength(a),k=0;j>k;k++){var l=this.diffLocation2(a,k);g[k]=l.ancestor,h[k]=l.parsimony,i[k]=l.tree}for(var m=new Array,k=0;k<i.length;k++)e(i[k],k,m,b,0);for(var n="",k=0;k<m.ancestor.length;k++)n+=this.RCHARS[m.ancestor[k]];f(m,this.RCHARS);var o={match:0,mismatch:0,gap_ext:0,gap_open:0},p=this.scoreTreeAlignment.bind(this)(m,o),q={};return q.ancestor=n,q.score=p,q.tree=m,q.info=o,q},FitchCalculator.prototype.scoreTreeAlignment=function b(a,c){if(a instanceof Object&&void 0!=a[0]){var d=0,e=0;return d+=b.bind(this)(a[0],c),d+=b.bind(this)(a[1],c),e+=this.scoreAlignment(a.ancestor,a[0].ancestor,c),e+=this.scoreAlignment(a.ancestor,a[1].ancestor,c),a.score=d+e,d+e}return 0},FitchCalculator.prototype.scoreAlignment=function(a,b,c){for(var d=0,e=!1,f=0,g=!0,h=0;h<a.length;h++)1==this.GAP_MATRIX[this.RCHARS[a[h]]][this.RCHARS[b[h]]]?g||(e?(d+=this.GAP_EXT,c.gap_ext+=1,f++):(d+=this.GAP_OPEN,e=!0,c.gap_open+=1,f=1)):0!=this.SCORE_MATRIX[this.RCHARS[a[h]]][this.RCHARS[b[h]]]&&(e=!1,g=!1,d+=this.SCORE_MATRIX[this.RCHARS[a[h]]][this.RCHARS[b[h]]],this.SCORE_MATRIX[this.RCHARS[a[h]]][this.RCHARS[b[h]]]>0?c.match+=1:c.mismatch+=1);return e&&(d-=(f-1)*this.GAP_EXT+this.GAP_OPEN,c.gap_ext-=f-1,c.gap_open-=1),d},FitchCalculator.prototype.diffLocation2=function(a,b){var c=[0],d=function h(a,b){if(a instanceof Array){var c=h(a[0],b),d=h(a[1],b);return 0==(c&d)?(b[0]++,a.seq=c|d):a.seq=c&d,a[2]=a.seq,a.seq}return a},e=this.extractLocation(a,b),f=d(e,c),g={};return g.ancestor=f,g.parsimony=c[0],g.tree=e,g},FitchCalculator.prototype.diffLocation=function(a,b){var c=[0],d=function h(a,b){if(a instanceof Array){var c=h(a[0],b),d=h(a[1],b);return 0==(c&d)?(b[0]++,a.seq=c|d,a.seq):(a.seq=c&d,a.seq)}return a},e=this.extractLocation(a,b),f=d(e,c),g={};return g.ancestor=f,g.parsimony=c[0],g.tree=e,g},FitchCalculator.prototype.extractLocation=function(a,b){return a instanceof Array?[this.extractLocation(a[0],b),this.extractLocation(a[1],b)]:this.CHARS[a.charAt(b)]};var fitch=new FitchCalculator;