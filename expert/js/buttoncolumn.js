function ButtonColumn(a){this.canvas=a,this.canvas.controller=this,this.ctx=a.getContext("2d"),this.buttons=[];var b=[new BCIcon({icon:"hdd",style:"white"}),new BCIcon({icon:"folder-open",style:"white"})],c=[["Save States"],[Language.get("bc-best"),null,b[1],"Best"],[this.getScoreForState("Best")],["1",b[0],b[1],"1"],[this.getScoreForState("1")],["2",b[0],b[1],"2"],[this.getScoreForState("2")]],d=[[""],["Best",null,function(){var a=localStorage.getItem(args.id+"-Best");if(a){var b=JSON.parse(a);loadState(b)}}],[],["1",function(){var a=getCurrentState();localStorage.setItem(args.id+"-1",JSON.stringify(a)),this.setScoreForState("1",a.score)},function(){var a=localStorage.getItem(args.id+"-1");if(a){var b=JSON.parse(a);loadState(b)}}],[],["2",function(){var a=getCurrentState();localStorage.setItem(args.id+"-2",JSON.stringify(a)),this.setScoreForState("2",a.score)},function(){var a=localStorage.getItem(args.id+"-2");if(a){var b=JSON.parse(a);loadState(b)}}],[]];for(var e in b)b[e].addListener("changed",function(){this.draw()},this);this.data=[];for(var f,e=0;e<c.length;e++){var g=e*G_H;f=[c[e][0]],c[e][1]?(button=new BCButton(~~(a.width-2*BC_BUTTON_W),~~(g+(G_H-BC_BUTTON_H)/2),c[e][1],BC_BUTTON_W,BC_BUTTON_H),this.buttons.push(button),f.push(button)):f.push(null),c[e][2]?(button=new BCButton(~~(a.width-BC_BUTTON_W),~~(g+(G_H-BC_BUTTON_H)/2),c[e][2],BC_BUTTON_W,BC_BUTTON_H),f.push(button),this.buttons.push(button)):f.push(null),f.push(c[e][3]),this.data.push(f)}var h=function(a){var b=$(this).offset(),c=a.pageX-b.left,d=a.pageY-b.top,e=!1;for(var f in this.controller.buttons)c>this.controller.buttons[f].x&&c<this.controller.buttons[f].x+this.controller.buttons[f].width&&d>this.controller.buttons[f].y&&d<this.controller.buttons[f].y+this.controller.buttons[f].height?(this.controller.buttons[f].setOver(!0)&&(e=!0),"mousedown"==a.type&&this.controller.buttons[f].setDown(!0)?e=!0:"mouseup"==a.type&&this.controller.buttons[f].setDown(!1)&&(e=!0),"mouseup"==a.type&&this.controller.buttons[f].fireEvent(new $.Event("clicked"))):this.controller.buttons[f].setOver(!1)&&(e=!0);e&&this.controller.draw()};$(this.canvas).mousemove(h),$(this.canvas).mousedown(h),$(this.canvas).mouseup(h),$(this.canvas).mouseout(function(){var a=!1;for(var b in this.controller.buttons)this.controller.buttons[b].setOver(!1)&&(a=!0),this.controller.buttons[b].setDown(!1)&&(a=!0);a&&this.controller.draw()});for(var e=0;e<d.length;e++)for(var i=0;i<d[e].length;i++)null!=this.data[e][i]&&"object"==typeof this.data[e][i]&&"function"==typeof d[e][i]&&this.data[e][i].addListener("clicked",d[e][i],this)}function BCButton(a,b,c,d,e){this.x=a,this.y=b,this.icon=c,this.width=d,this.height=e,this.listeners=[],this.over=!1}function BCIcon(a){BCIcon.inited||BCIcon.init(),a.icon?(this.x=BCIcon.coords[a.icon].x,this.y=BCIcon.coords[a.icon].y):(this.x=a.x,this.y=a.y),this.style="undefined"!=typeof a.style?a.style:"black",this.image=BCIcon.images[this.style],this.width=14,this.height=14,this.listeners=[],BCIcon.allInstances.push(this)}ButtonColumn.prototype.setScoreForState=function(a,b){for(var c=0;c<this.data.length-1;c++)this.data[c][3]&&this.data[c][3]==a&&(this.data[c+1][0]=b);this.draw()},ButtonColumn.prototype.getScoreForState=function(a){var b=localStorage.getItem(args.id+"-"+a);if(b){var a=JSON.parse(b);return a.score}return null},ButtonColumn.prototype.draw=function(){var a=this.ctx,b=this.canvas.width,c=this.canvas.height;a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,b,c),a.restore();var d=a.createLinearGradient(0,0,BC_BACKGROUND_GRID_W,0);d.addColorStop(0,G_COLOUR),d.addColorStop(1,G_COLOUR_A),a.strokeStyle=d,a.fillStyle=G_COLOUR,a.lineWidth=1,a.beginPath();for(var e=0;G_ROW>=e;e++)a.moveTo(-.5,e*G_H+.5),a.lineTo(BC_BACKGROUND_GRID_W+.5,e*G_H+.5);a.closePath(),a.stroke(),a.font="10pt sans-serif",a.textBaseline="middle",a.textAlign="left";for(var e=0;e<this.data.length;e++){var f=e*G_H;this.data[e][0]&&"string"==typeof this.data[e][0]?a.fillText(this.data[e][0],5,f+G_H/2):this.data[e][0]&&"number"==typeof this.data[e][0]&&(a.save(),a.font="8pt sans-serif",a.textAlign="right",a.textBaseline="top",a.fillText(Language.get("bc-score")+": "+this.data[e][0],BC_W-BC_BUTTON_W/3,f),a.restore()),this.data[e][1]&&(a.save(),a.translate(this.data[e][1].x,this.data[e][1].y),this.data[e][1].draw(a),a.restore()),this.data[e][2]&&(a.save(),a.translate(this.data[e][2].x,this.data[e][2].y),this.data[e][2].draw(a),a.restore())}},BCButton.prototype.fireEvent=function(a){a.target=this;for(var b in this.listeners[a.type])a.listenerId=b,this.listeners[a.type][b][0].call(this.listeners[a.type][b][1],a)},BCButton.prototype.setDown=function(a){return a!=this.down?(this.down=a,!0):!1},BCButton.prototype.setOver=function(a){return a!=this.over?(this.over=a,!0):!1},BCButton.prototype.addListener=function(a,b,c){return void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push([b,c]),this.listeners[a].length-1},BCButton.prototype.removeListener=function(a,b){delete this.listeners[a][b]},BCButton.prototype.draw=function(a){if(a.clearRect(0,0,this.width,this.height),this.down?(a.fillStyle=BC_BUTTON_DOWN_COLOUR,a.fillRect(0,0,this.width,this.height)):this.over&&(a.fillStyle=BC_BUTTON_OVER_COLOUR,a.fillRect(0,0,this.width,this.height)),this.icon&&this.icon.image){var b=~~((this.width-this.icon.width)/2),c=~~((this.height-this.icon.height)/2);a.drawImage(this.icon.image,this.icon.x,this.icon.y,this.icon.width,this.icon.height,b>=0?b:0,c>=0?c:0,this.icon.width,this.icon.height)}},BCIcon.imageSrcs={black:"img/glyphicons-halflings.png",white:"img/glyphicons-halflings.png"},BCIcon.coords={download:{x:120,y:24},upload:{x:144,y:24},"folder-open":{x:408,y:120},hdd:{x:0,y:144}},BCIcon.images={},BCIcon.inited=!1,BCIcon.allInstances=[],BCIcon.init=function(){BCIcon.inited=!0;for(var a in BCIcon.imageSrcs){var b=new Image;b.key=a,b.onload=function(){for(var a in BCIcon.allInstances)BCIcon.allInstances[a].style==this.key&&(BCIcon.allInstances[a].image=this,BCIcon.allInstances[a].fireEvent(new $.Event("changed")))},b.onerror=function(){console.log("error loading BCIcon: "+this.key)},b.src=BCIcon.imageSrcs[a],BCIcon.images[a]=b}},BCIcon.prototype.changeStyle=function(a){this.path=this.paths[a]},BCIcon.prototype.fireEvent=function(a){a.target=this;for(var b in this.listeners[a.type])a.listenerId=b,this.listeners[a.type][b][0].call(this.listeners[a.type][b][1],a)},BCIcon.prototype.addListener=function(a,b,c){return void 0===this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push([b,c]),this.listeners[a].length-1},BCIcon.prototype.removeListener=function(a,b){delete this.listeners[a][b]};